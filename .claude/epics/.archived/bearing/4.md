---
name: Data Model and Persistence
status: closed
created: 2026-01-31T14:36:57Z
updated: 2026-01-31T14:42:57Z
github: https://github.com/rknuus/Bearing/issues/4
depends_on: [2, 3]
parallel: false
conflicts_with: []
---

# Task: Data Model and Persistence

## Description
Define the JSON schemas for Bearing's data model (LifeTheme, Objective, KeyResult, DayFocus, Task) and implement PlanAccess service for reading/writing data with git versioning.

## Acceptance Criteria
- [ ] Go structs defined for all data types with JSON tags
- [ ] PlanAccess service implements CRUD for all entities
- [ ] File storage uses theme-based directories
- [ ] Task files stored in kanban column subdirectories
- [ ] All writes use VersioningUtility transactions
- [ ] Hierarchical IDs generated correctly (THEME-01.OKR-01.KR-01)

## Technical Details

### Data Structures (Go)
```go
type LifeTheme struct {
    ID         string      `json:"id"`         // THEME-01
    Name       string      `json:"name"`
    Color      string      `json:"color"`      // hex
    Objectives []Objective `json:"objectives"`
}

type Objective struct {
    ID         string      `json:"id"`         // THEME-01.OKR-01
    Title      string      `json:"title"`
    KeyResults []KeyResult `json:"keyResults"`
}

type KeyResult struct {
    ID          string `json:"id"`          // THEME-01.OKR-01.KR-01
    Description string `json:"description"`
}

type DayFocus struct {
    Date    string `json:"date"`    // YYYY-MM-DD
    ThemeID string `json:"themeId"` // links to LifeTheme
    Notes   string `json:"notes"`
}

type Task struct {
    ID       string `json:"id"`
    Title    string `json:"title"`
    ThemeID  string `json:"themeId"`
    DayDate  string `json:"dayDate"`
    Priority string `json:"priority"` // important-urgent|not-important-urgent|important-not-urgent
    // Status derived from directory location
}
```

### File Structure
```
data/
├── themes/
│   └── themes.json           # All LifeThemes with OKRs
├── calendar/
│   └── 2026.json            # DayFocus entries for year
└── tasks/
    └── THEME-01/
        ├── todo/
        │   └── task-001.json
        ├── doing/
        └── done/
```

### PlanAccess Interface
```go
type IPlanAccess interface {
    // Themes
    GetThemes() ([]LifeTheme, error)
    SaveTheme(theme LifeTheme) error
    DeleteTheme(id string) error

    // Calendar
    GetDayFocus(date string) (*DayFocus, error)
    SaveDayFocus(day DayFocus) error
    GetYearFocus(year int) ([]DayFocus, error)

    // Tasks
    GetTasksByTheme(themeId string) ([]Task, error)
    GetTasksByStatus(themeId, status string) ([]Task, error)
    SaveTask(task Task) error
    MoveTask(taskId, newStatus string) error  // git mv
    DeleteTask(taskId string) error
}
```

## Dependencies
- [ ] Task #2: Project Setup
- [ ] Task #3: Utility Migration (for versioning)

## Effort Estimate
- Size: M
- Hours: 8-12
- Parallel: false

## Definition of Done
- [ ] All data structures defined with JSON serialization
- [ ] PlanAccess implements full interface
- [ ] Unit tests for CRUD operations
- [ ] MoveTask uses git mv (verified in git history)
- [ ] Hierarchical ID generation tested
