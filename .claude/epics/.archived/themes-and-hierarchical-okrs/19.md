---
name: Refactor PlanningManager CRUD for recursive tree-walking
status: closed
created: 2026-02-06T10:11:45Z
updated: 2026-02-06T10:17:09Z
github: https://github.com/rknuus/Bearing/issues/19
depends_on: [17]
parallel: false
conflicts_with: []
---

# Refactor PlanningManager CRUD for recursive tree-walking

## Description

Simplify the PlanningManager CRUD API to support objectives at arbitrary depth. Replace the current flat-access patterns with recursive tree-walking so that objectives can be created, updated, and deleted under any parent (theme or objective). Add a recursive helper `findObjectiveInTree()` that locates an objective by ID and returns a pointer to the parent's slice for direct mutation. Apply the same recursive approach to key result operations.

## Acceptance Criteria

- [ ] `CreateObjective(parentId, title)` creates an objective under a theme ID or any objective ID
- [ ] `UpdateObjective(objectiveId, title)` finds the objective by walking the tree and updates its title
- [ ] `DeleteObjective(objectiveId)` walks the tree, removes the objective from its parent's slice (children cascade by structure)
- [ ] `CreateKeyResult(parentObjectiveId, desc)` creates a KR under any objective at any depth
- [ ] `UpdateKeyResult(krId, desc)` finds and updates a KR anywhere in the tree
- [ ] `DeleteKeyResult(krId)` finds and removes a KR anywhere in the tree
- [ ] Recursive helper `findObjectiveInTree()` returns a pointer to the parent's objectives slice for mutation
- [ ] All existing manager tests still pass

## Technical Details

- **Files**: `internal/managers/planning_manager.go`
- Add `findObjectiveInTree(objectives []Objective, id string) (*[]Objective, int)` â€” returns the parent slice and index of the matched objective
- `CreateObjective(parentId, title)`: locate parent (theme or objective) via tree walk, append new `Objective` to its `Objectives` slice, call `ensureThemeIDs()`, save
- `UpdateObjective(objectiveId, title)`: walk tree to find the objective, update title in place, save
- `DeleteObjective(objectiveId)`: walk tree to find parent slice, remove by index (children are removed automatically since they are nested in the struct), save
- KR operations follow the same pattern: walk the tree to find the parent objective, then operate on its `KeyResults` slice
- All mutations call `ensureThemeIDs()` before saving to keep IDs consistent after structural changes

## Dependencies

- **#17**: Recursive data model and ID generation (must be completed first so the `Objectives` field and recursive ID generation exist)

## Effort Estimate

- **Size**: M
- **Hours**: 2

## Definition of Done

- Can create, update, and delete objectives at arbitrary nesting depth via the simplified API
- Can create, update, and delete key results under any objective at any depth
- `findObjectiveInTree()` helper is implemented and used by all CRUD operations
- All existing manager tests pass without modification
- New tests cover CRUD at multiple nesting levels
