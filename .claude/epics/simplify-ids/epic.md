---
name: simplify-ids
status: backlog
created: 2026-02-07T14:29:32Z
progress: 0%
prd: .claude/prds/simplify-ids.md
github: https://github.com/rknuus/Bearing/issues/34
---

# Epic: simplify-ids

## Overview

Replace hierarchical dot-notation IDs (`THEME-01.OKR-01.KR-01`) with flat, globally unique IDs (`THEME-1`, `OBJ-1`, `KR-1`, `TASK-1`). Add explicit `parentId` fields to `Objective` and `KeyResult` to track hierarchy. This is a breaking change — no data migration.

## Architecture Decisions

- **Flat IDs with prefix**: `THEME-N`, `OBJ-N`, `KR-N`, `TASK-N` — unpadded integers, uppercase prefixes for consistency.
- **Global counters per type**: Each entity type has a single counter derived by scanning all existing entities at runtime (same approach as today, but globally scoped instead of per-parent).
- **Explicit `parentId`**: Added to `Objective` and `KeyResult` structs. Denormalized — the nested JSON structure is preserved, `parentId` provides a fast way to traverse upward without walking the tree.
- **Nested storage preserved**: `themes.json` keeps its nested structure. No migration to a flat entity store.
- **Tree-walking for breadcrumbs**: Frontend replaces ID string parsing (`split('.')`) with walking the theme tree via `parentId` chains.

## Technical Approach

### Backend (Go)

**Models** (`internal/access/models.go`):
- Add `ParentID string` to `Objective` and `KeyResult` structs.
- Update comments to reflect flat ID scheme.

**ID Generation** (`internal/access/plan_access.go`):
- `generateThemeID()`: Change format from `THEME-%02d` to `THEME-%d` (drop padding).
- `ensureObjectiveIDs()`: Refactor from hierarchical (`parentID.OKR-%02d`) to flat (`OBJ-%d`). Scan all objectives globally for max counter. Set `parentId` on each objective. Recurse into children.
- Key result IDs: Change from `objectiveID.KR-%02d` to `KR-%d`. Scan globally.
- `generateTaskID()`: Change from `task-%03d` to `TASK-%d`.

**Binding structs** (`main.go`):
- Add `ParentID` to `Objective` and `KeyResult` binding types.
- Update conversion functions (`convertObjective`, `convertObjectiveToAccess`).

**Tree-walking functions** (`internal/managers/planning_manager.go`):
- `findObjectiveByID`, `findObjectiveParent`, `findKeyResultParent` — no changes needed, they already match by ID string.

### Frontend (Svelte/TypeScript)

**ID parser** (`frontend/src/lib/utils/id-parser.ts`):
- Rewrite `getIdType()` to match on prefix (`THEME-`, `OBJ-`, `KR-`, `TASK-`).
- Rewrite `getParentId()` to look up `parentId` from the data, or remove if unused.
- Remove `parseHierarchicalId()` — replace with a function that builds breadcrumbs by walking `parentId` chains on theme data.

**OKRView** (`frontend/src/views/OKRView.svelte`):
- Replace `highlightItemId.split('.')` ancestor expansion with tree-walking using `parentId`.

**Mock data** (`frontend/src/lib/wails-mock.ts`):
- Update all mock IDs to flat format.
- Add `parentId` to mock objectives and key results.
- Update `CreateObjective()` and `CreateKeyResult()` to generate flat IDs.

**Wails types** (`frontend/src/lib/wails/wailsjs/go/models.ts`):
- Auto-regenerated by `wails generate` after Go model changes.

### Tests

- `internal/access/plan_access_test.go`: Update all hierarchical ID assertions to flat IDs + parentId checks.
- `internal/integration/integration_test.go`: Same — update ID format expectations.
- `frontend/src/lib/utils/id-parser.test.ts`: Rewrite to test new prefix-based parsing and tree-walking.

## Tasks Created

- [ ] #36 - Update Go models and ID generation (parallel: false)
- [ ] #39 - Update Wails binding structs and conversions (parallel: false, depends: #36)
- [ ] #40 - Update Go unit tests (parallel: true, depends: #36)
- [ ] #41 - Update Go integration tests (parallel: true, depends: #36, #39)
- [ ] #35 - Rewrite frontend id-parser and tests (parallel: true, depends: #39)
- [ ] #37 - Update OKRView ancestor expansion logic (parallel: true, depends: #39)
- [ ] #38 - Update mock data and mock bindings (parallel: true, depends: #39)

Total tasks: 7
Parallel tasks: 5
Sequential tasks: 2

## Dependencies

- #36 → #39 (binding structs depend on model changes)
- #36, #39 → #40, #41 (tests depend on model + binding changes)
- #39 → #35, #37, #38 (frontend depends on regenerated TypeScript types)

## Success Criteria (Technical)

- All IDs match `PREFIX-N` format — no dots, no zero-padding, uppercase.
- `parentId` correctly set on all objectives and key results.
- `make frontend-lint` and `make frontend-check` pass.
- All Go tests pass (`make test` or equivalent).
- Breadcrumb navigation and highlight expansion work in OKRView.
- Mock bindings produce correct flat IDs for browser testing.
