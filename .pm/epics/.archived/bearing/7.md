---
name: Calendar View
status: closed
created: 2026-01-31T14:36:57Z
updated: 2026-01-31T14:42:57Z
github: https://github.com/rknuus/Bearing/issues/7
depends_on: [4, 5]
parallel: true
conflicts_with: [6, 8]
---

# Task: Calendar View

## Description
Implement the mid-term planning view showing a yearly calendar grid (12 months × 31 days). Users can assign each day to a Life Theme (showing the theme's color) and add optional notes.

## Acceptance Criteria
- [ ] Display 12 columns (months) × 31 rows (days)
- [ ] Weekend days visually distinguished (background shade)
- [ ] Click day to assign/change theme (dropdown of available themes)
- [ ] Day shows theme color when assigned
- [ ] Optional notes field per day
- [ ] Full year visible at once (scrollable if needed)
- [ ] Today highlighted

## Technical Details

### CalendarView.svelte Structure
```svelte
<script lang="ts">
  import { ThemeBadge } from '$lib/components';
  import { getYearFocus, getThemes, saveDayFocus } from '$lib/api';

  let year = $state(new Date().getFullYear());
  let themes = $state<LifeTheme[]>([]);
  let dayFocusMap = $state<Map<string, DayFocus>>(new Map());

  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                  'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

  function isWeekend(month: number, day: number): boolean {
    const date = new Date(year, month, day);
    return date.getDay() === 0 || date.getDay() === 6;
  }

  function getThemeColor(date: string): string | null {
    const focus = dayFocusMap.get(date);
    if (!focus) return null;
    return themes.find(t => t.id === focus.themeId)?.color ?? null;
  }
</script>

<div class="calendar-view">
  <header>
    <button onclick={() => year--}>‹</button>
    <h1>{year}</h1>
    <button onclick={() => year++}>›</button>
  </header>

  <div class="calendar-grid">
    <!-- Header row: month names -->
    <div class="row header">
      <div class="day-label"></div>
      {#each months as month}
        <div class="month-header">{month}</div>
      {/each}
    </div>

    <!-- Day rows: 1-31 -->
    {#each Array.from({length: 31}, (_, i) => i + 1) as day}
      <div class="row">
        <div class="day-label">{day}</div>
        {#each Array.from({length: 12}, (_, i) => i) as month}
          {@const date = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`}
          {@const color = getThemeColor(date)}
          <div
            class="day-cell"
            class:weekend={isWeekend(month, day)}
            class:invalid={!isValidDate(year, month, day)}
            style={color ? `--theme-color: ${color}` : ''}
            onclick={() => openDayEditor(date)}
          >
            {#if color}
              <div class="theme-fill"></div>
            {/if}
          </div>
        {/each}
      </div>
    {/each}
  </div>
</div>
```

### CSS for Grid Performance
```css
.calendar-grid {
  display: grid;
  grid-template-columns: 40px repeat(12, 1fr);
  gap: 1px;
  font-size: 0.75rem;
}

.day-cell {
  aspect-ratio: 1;
  min-width: 20px;
  position: relative;
}

.day-cell.weekend {
  background-color: #f5f5f5;
}

.day-cell .theme-fill {
  position: absolute;
  inset: 2px;
  background-color: var(--theme-color);
  opacity: 0.7;
  border-radius: 2px;
}
```

### Day Editor Dialog
- Dropdown to select theme (shows color swatches)
- Text area for notes
- Save/Cancel buttons
- "Clear" option to remove theme assignment

### Wails Bindings
```go
func (m *PlanningManager) GetYearFocus(year int) ([]DayFocus, error)
func (m *PlanningManager) SaveDayFocus(day DayFocus) error
func (m *PlanningManager) ClearDayFocus(date string) error
```

## Dependencies
- [ ] Task #4: Data Model (DayFocus struct, themes for color lookup)
- [ ] Task #5: Linking Components (color propagation CSS)

## Effort Estimate
- Size: M
- Hours: 8-12
- Parallel: true (can run with #6, #8 but may have merge conflicts)

## Definition of Done
- [ ] Full year grid renders without performance issues
- [ ] Theme assignment shows correct colors
- [ ] Weekend/weekday distinction visible
- [ ] Notes can be saved per day
- [ ] Invalid dates (Feb 30, etc.) handled gracefully
- [ ] Data persists across app restarts
