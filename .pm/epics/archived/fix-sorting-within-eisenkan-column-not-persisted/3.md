---
name: Manager layer — ReorderTasks + order maintenance in GetTasks/MoveTask/CreateTask/DeleteTask
status: closed
created: 2026-02-20T15:47:33Z
updated: 2026-02-20T15:47:33Z
github: Will be updated when synced to GitHub
depends_on: [2]
parallel: false
conflicts_with: []
---

# Task: Manager layer — ReorderTasks + order maintenance in GetTasks/MoveTask/CreateTask/DeleteTask

## Description
Add `ReorderTasks` method to `IPlanningManager` and modify `GetTasks`, `MoveTask`, `CreateTask`, and `DeleteTask` to maintain task ordering via `task_order.json`. The manager layer coordinates all order updates through the access layer's `LoadTaskOrder`/`SaveTaskOrder`.

## Acceptance Criteria
- [ ] New `ReorderTasks(positions map[string][]string) (*ReorderResult, error)` method on `IPlanningManager`
- [ ] New `ReorderResult` type: `{ Success bool; Positions map[string][]string }`
- [ ] `ReorderTasks` validates that referenced task IDs exist, merges proposed positions into the full order map, persists via `SaveTaskOrder`, and returns authoritative positions for all drop zones
- [ ] `GetTasks` sorts tasks within each status group by their position in `task_order.json`; tasks not in the order map are appended at the end sorted by `CreatedAt`
- [ ] `MoveTask` removes task from source drop zone order and appends to target drop zone order after a successful cross-column move
- [ ] `MoveTaskResult` extended with `Positions map[string][]string` field
- [ ] `CreateTask` appends new task ID to its drop zone in `task_order.json`
- [ ] `DeleteTask` removes the task ID from `task_order.json`
- [ ] Self-healing: stale entries (deleted tasks) silently filtered on load; missing tasks appended
- [ ] Backward compatibility: if `task_order.json` doesn't exist, `GetTasks` returns tasks sorted by `CreatedAt`
- [ ] Unit tests cover: reorder persistence, order in GetTasks, order after MoveTask/CreateTask/DeleteTask, self-healing, backward compatibility

## Technical Details
- `ReorderTasks` flow: LoadTaskOrder → validate task IDs → merge proposed positions → SaveTaskOrder → return full positions
- Drop zone ID derivation: For Todo column tasks, use the priority section label (e.g., `important-urgent`). For Doing/Done columns, use the column name (e.g., `doing`, `done`). This matches `BoardConfiguration.SectionDefinition.Name` and `ColumnDefinition.Name`.
- `GetTasks` needs to load the order map once and use it to sort task slices per status group
- `MoveTask` already determines source/target status — extend to also update order map
- Mock `IPlanAccess` in tests to isolate manager logic from file I/O

## Dependencies
- [ ] Task 2: Access layer LoadTaskOrder/SaveTaskOrder

## Effort Estimate
- Size: M
- Parallel: false (depends on task 2, foundation for tasks 4-5)

## Definition of Done
- [ ] Code implemented
- [ ] Tests written and passing
- [ ] Linting passes
