---
name: Frontend — wails-mock.ts ordering + EisenKanView.svelte backend-authoritative ordering
status: closed
created: 2026-02-20T15:47:33Z
updated: 2026-02-20T15:47:33Z
github: Will be updated when synced to GitHub
depends_on: [4]
parallel: false
conflicts_with: []
---

# Task: Frontend — wails-mock.ts ordering + EisenKanView.svelte backend-authoritative ordering

## Description
Update the frontend to use backend-authoritative task ordering. Update `wails-mock.ts` with `taskPositions` state and `ReorderTasks` implementation. Update `EisenKanView.svelte` to remove client-side auto-sorting, call `ReorderTasks` on within-zone reorders, and reconcile with backend-authoritative positions after all operations.

## Acceptance Criteria
- [ ] **wails-mock.ts**: Add `taskPositions: Record<string, string[]>` state tracking ordered task IDs per drop zone
- [ ] **wails-mock.ts**: Implement `ReorderTasks(positions)` — validate, update positions, return authoritative result
- [ ] **wails-mock.ts**: Update `MoveTask` mock to maintain `taskPositions` (remove from source zone, append to target)
- [ ] **wails-mock.ts**: Update `GetTasks` mock to return tasks in `taskPositions` order
- [ ] **wails-mock.ts**: Update `CreateTask` mock to append new task to its drop zone in `taskPositions`
- [ ] **wails-mock.ts**: Update `DeleteTask` mock to remove task from `taskPositions`
- [ ] **EisenKanView.svelte**: Remove the auto-sort by priority `$effect` block (lines ~145-159) — backend returns pre-sorted tasks
- [ ] **EisenKanView.svelte**: Replace the early `return` on same-column reorder (line ~329) with a `ReorderTasks` call
- [ ] **EisenKanView.svelte**: Replace the early `return` on same-section reorder in `handleSectionDndFinalize` with a `ReorderTasks` call
- [ ] **EisenKanView.svelte**: After `MoveTask` calls, use returned `positions` to update display order
- [ ] **EisenKanView.svelte**: Optimistic UI — apply drag result immediately, reconcile with backend response on callback
- [ ] All existing frontend tests pass
- [ ] Frontend linting and type checking pass
- [ ] Works in all three dev environments: native app, localhost:34115, localhost:5173

## Technical Details
- Reference the standalone eisenkan mock at `tmp/eisenkan/frontend/src/lib/api/mock.ts` for the `taskPositions` pattern
- Drop zone IDs match the convention: priority labels for Todo sections, column names for others
- The `$effect` block that auto-sorts by priority must be removed — the backend now returns tasks in the correct order via `GetTasks`
- For optimistic UI: apply the DnD result to the local state immediately, then send the `ReorderTasks` call. On response, reconcile local state with the authoritative positions. If the backend disagrees, the UI corrects itself.
- Be careful with `$effect` blocks: never read and write the same `$state` variable. Use `untrack()` where needed.
- Ensure no uncaught exceptions or infinite loops in the native application variant

## Dependencies
- [ ] Task 4: Wails bindings (ReorderTasks binding + updated MoveTask return type + generated TypeScript types)

## Effort Estimate
- Size: M
- Parallel: false (depends on all prior tasks)

## Definition of Done
- [ ] Code implemented
- [ ] Frontend tests passing
- [ ] Frontend linting passes (`make frontend-lint`)
- [ ] Type checking passes (`make frontend-check`)
- [ ] Manual verification in browser dev environment (localhost:5173)
