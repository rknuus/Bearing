---
name: Extract Go backend helpers and refactor call sites
status: done
created: 2026-02-13T15:18:07Z
updated: 2026-02-13T15:26:53Z
github: [Will be updated when synced to GitHub]
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Extract Go backend helpers and refactor call sites

## Description
Extract three helper functions from `internal/access/plan_access.go` to eliminate duplicated logic blocks: a git transaction helper, a task-finding helper, and a JSON write helper. Refactor all existing call sites to use the new helpers.

## Acceptance Criteria
- [ ] `commitFiles(paths []string, message string) error` private method on `PlanAccess` replaces git transaction boilerplate (relative path resolution, begin, stage, commit) in 6+ methods
- [ ] `findTaskInPlan(taskID string)` private method returns task, theme ID, status name, and index — used by `MoveTask`, `DeleteTask`, `findTaskStatus`
- [ ] `writeJSON(filePath string, v any) error` package-level function handles `MarshalIndent` + `WriteFile` — used by 5+ methods
- [ ] All existing Go tests pass without modification (`make test-backend`)
- [ ] Error messages remain descriptive with caller context
- [ ] No changes to public API signatures

## Technical Details

### Files affected
- **Modified**: `internal/access/plan_access.go`

### Helper signatures
```go
// Private method — needs access to pa.repo
func (pa *PlanAccess) commitFiles(paths []string, message string) error

// Private method — needs access to pa.plan
func (pa *PlanAccess) findTaskInPlan(taskID string) (*Task, string, string, int, error)

// Package-level function — stateless
func writeJSON(filePath string, v any) error
```

### Call sites to refactor
- **commitFiles**: `SaveTheme`, `SaveDayFocus`, `SaveTask`, `MoveTask`, `DeleteTask`, and any other method with the git transaction pattern
- **findTaskInPlan**: `MoveTask`, `DeleteTask`, `findTaskStatus`
- **writeJSON**: All methods that do `json.MarshalIndent` + `os.WriteFile`

### Key considerations
- Read `plan_access.go` thoroughly before extracting — ensure all instances of each pattern are identified
- The `MoveTask` method stages multiple files (old + new location) — `commitFiles` must accept a slice of paths
- `DeleteTask` removes a file then commits — verify `commitFiles` handles this correctly (stage after delete)
- Preserve exact error message formatting where tests depend on it

## Dependencies
- None

## Effort Estimate
- Size: M
- Hours: 2
- Parallel: true (independent of frontend task)
