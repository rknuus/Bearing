---
name: Fix sectioned dndzone item arrays and section-aware drag handlers
status: open
created: 2026-02-13T10:15:54Z
updated: 2026-02-13T10:15:54Z
github: [Will be updated when synced to GitHub]
depends_on: []
parallel: true
conflicts_with: [003]
---

# Task: Fix sectioned dndzone item arrays and section-aware drag handlers

## Description

Fix the core drag-and-drop crash in EisenKanView.svelte caused by a mismatch between `dndzone` items and rendered DOM children in sectioned columns. Each priority section's `dndzone` currently receives all column items but only renders section-filtered items, causing `svelte-dnd-action` to crash with `TypeError: undefined is not an object (evaluating 'originalDragTarget.parentElement')`.

## Acceptance Criteria

- [ ] Each priority section's `dndzone` receives only that section's tasks as items
- [ ] Dragging a task between columns (e.g., Todo → Doing) updates its status via `MoveTask` API
- [ ] Dragging a task between priority sections within Todo updates its priority via `UpdateTask` API
- [ ] Optimistic update + rollback pattern is preserved for both move types
- [ ] Rule violations show the ErrorDialog and revert the move
- [ ] No JavaScript errors during any drag operation
- [ ] Mock bindings in `wails-mock.ts` updated if needed for section-level operations

## Technical Details

### Files Affected
- `frontend/src/views/EisenKanView.svelte` — primary changes

### Implementation Approach

1. **Introduce per-section item state**: Add `sectionItems` state alongside `columnItems`. The existing `$effect` (lines 106-141) should also populate section-level arrays keyed by section name.

2. **Fix sectioned dndzone items** (lines 442-444): Change from `items: columnItems[column.name]` to `items: sectionItems[section.name]` so each section's dndzone receives only its own tasks.

3. **Add section-aware handlers**: Create `handleSectionDndConsider(sectionName, event)` and `handleSectionDndFinalize(columnName, sectionName, event)` that:
   - Update `sectionItems[sectionName]` during consider (preview)
   - On finalize: detect if the dropped task came from a different section (priority change) or a different column (status change)
   - For priority changes: call `UpdateTask` with updated priority field
   - For status changes: call existing `MoveTask` with the column's status
   - Rollback both `sectionItems` and master `tasks` on failure

4. **Reconcile section items with master state**: After a successful move, update the master `tasks` array so the `$effect` re-derives `sectionItems` correctly. Use `untrack()` pattern to avoid infinite loops.

### Key Considerations
- `svelte-dnd-action` requires items array to exactly match rendered children (proven pattern in `EisenhowerQuadrant.svelte`)
- Regular (non-sectioned) columns already work correctly with `columnItems[column.name]` — don't change those
- Subtask cards are rendered inside parent iterations — ensure they don't interfere with dndzone item tracking

## Dependencies

- [ ] No task dependencies — can start immediately

## Effort Estimate
- Size: M
- Parallel: true
