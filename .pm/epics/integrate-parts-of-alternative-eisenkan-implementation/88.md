---
name: Replace drag-drop with svelte-dnd-action and optimistic rollback
status: open
created: 2026-02-08T14:54:43Z
updated: 2026-02-08T14:59:38Z
github: https://github.com/rknuus/Bearing/issues/88
depends_on: [001, 002]
parallel: true
conflicts_with: [006]
---

# Task: Replace drag-drop with svelte-dnd-action and optimistic rollback

## Description

Replace the HTML5 native drag-drop implementation in EisenKanView with `svelte-dnd-action` for touch/keyboard accessibility and smoother UX. Implement the `MoveTasksResult` pattern from the EisenKan reference: optimistic UI updates with automatic rollback when the backend rejects a move (e.g., WIP limit exceeded). Add `isValidating` and `isRollingBack` state flags to disable drag during transitions.

## Acceptance Criteria

- [ ] `svelte-dnd-action` installed as npm dependency
- [ ] HTML5 drag handlers (`dragstart`, `dragover`, `dragleave`, `drop`) removed from EisenKanView
- [ ] `use:dndzone` directive used on column drop zones with `onconsider` and `onfinalize` handlers
- [ ] `onconsider` updates UI immediately (preview during drag)
- [ ] `onfinalize` sends move to backend and processes `MoveTasksResult`
- [ ] On `MoveTasksResult.success === false`: UI rolls back to `taskPositions` from backend response
- [ ] `isValidating` flag set during backend call; `isRollingBack` flag set during rollback animation
- [ ] Drag disabled when `isValidating || isRollingBack`
- [ ] Touch device drag-drop works
- [ ] Keyboard navigation for drag-drop works (svelte-dnd-action built-in)
- [ ] `flipDurationMs` set for smooth reorder animations
- [ ] MoveTask backend API returns `MoveTasksResult` with success flag and authoritative positions
- [ ] Mock bindings updated to support `MoveTasksResult` pattern with configurable failure
- [ ] Existing task sorting by priority in Todo column preserved
- [ ] Unit tests for optimistic update and rollback behavior

## Technical Details

**Files to modify:**
- `frontend/src/views/EisenKanView.svelte` — replace all drag handlers with svelte-dnd-action; add `isValidating`/`isRollingBack` state; update `MoveTask` call to handle `MoveTasksResult`
- `frontend/src/lib/wails-mock.ts` — update `MoveTask` mock to return `MoveTasksResult`; add configurable failure mode
- `frontend/src/views/EisenKanView.test.ts` — update drag-drop tests for new pattern
- `internal/managers/planning_manager.go` — update `MoveTask` return type to include validation result and authoritative positions

**Key considerations:**
- svelte-dnd-action uses `items` array with `id` field — task objects already have `id`
- Each column is a separate dnd zone; cross-zone drag changes task status
- The `MoveTasksResult.taskPositions` is a map of zone ID → task ID arrays — backend always returns this as authoritative truth
- `flipDurationMs: 200` for smooth animations (match reference)
- Ensure both Wails native and browser mock variants work

**Reference:** `tmp/eisenkan/frontend/src/components/KanbanBoard.svelte` for the `finalizeDragOnUi` pattern

## Dependencies

- [ ] Task 001 — extended model with MoveTasksResult return type
- [ ] Task 002 — rule engine for move validation

## Effort Estimate

- Size: L
- Parallel: true — can run alongside tasks 004, 005
