---
name: Frontend — ThemeFilterBar component, state plumbing, smart default
status: done
created: 2026-02-13T15:37:02Z
updated: 2026-02-13T15:37:02Z
github: [Will be updated when synced to GitHub]
depends_on: [001]
parallel: false
conflicts_with: []
---

# Task: Frontend — ThemeFilterBar component, state plumbing, smart default

## Description
Create the ThemeFilterBar component, update App.svelte state model from single `filterThemeId` to `filterThemeIds` array, integrate the pill bar into EisenKanView, update cross-view navigation callbacks, and implement the smart default from today's calendar theme.

## Acceptance Criteria
- [ ] New `frontend/src/components/ThemeFilterBar.svelte` renders theme pills with "All" button
- [ ] Active pills show full theme color; inactive pills show dimmed/outlined style
- [ ] Clicking a pill toggles it in/out of the active filter set
- [ ] Clicking "All" clears all theme filters (shows all tasks)
- [ ] `App.svelte` state changed from `filterThemeId: string | undefined` to `filterThemeIds: string[]`
- [ ] `EisenKanView.svelte` prop changed from `filterThemeId?: string` to `filterThemeIds: string[]`
- [ ] `EisenKanView.svelte` `filteredTasks` logic updated for multi-theme filtering
- [ ] `CalendarView.svelte` prop changed from `filterThemeId` to `filterThemeIds` for legend highlighting
- [ ] Navigation context save/load handles `filterThemeIds` array (reads both old `filterThemeId` string and new `filterThemeIds` array)
- [ ] `handleNavigateToTheme` in App.svelte sets `filterThemeIds = [themeId]`
- [ ] Breadcrumb display updated for multi-theme filter
- [ ] Smart default: on first open with no persisted filter, pre-select today's DayFocus theme (or show all if none)
- [ ] Filter persists across view switches and app restarts
- [ ] Works in all three dev environments (native app, Wails dev, Vite mock)
- [ ] Frontend lint passes (`make frontend-lint`)
- [ ] All existing frontend tests pass (`make test-frontend`)

## Technical Details

### New file
- `frontend/src/components/ThemeFilterBar.svelte`
  - Props: `themes: LifeTheme[]`, `activeThemeIds: string[]`, `onToggle: (themeId: string) => void`, `onClear: () => void`
  - "All" pill: active when `activeThemeIds.length === 0`
  - Theme pills: active when `activeThemeIds.includes(theme.id)`
  - Use CSS design tokens for colors; reference `ThemeBadge` styling patterns

### Modified files
- `frontend/src/App.svelte`
  - State: `let filterThemeIds = $state<string[]>([])` replacing `filterThemeId`
  - Breadcrumb: show "Themes: X, Y" or single "Theme: X" based on count
  - Nav context save: write `filterThemeIds` array to context
  - Nav context load: read `filterThemeIds` from context; if empty, fall back to `filterThemeId` (single string backward compat); if still empty, apply smart default
  - Smart default: call `GetYearFocus(currentYear)`, find today's entry, use its themeId
  - `handleNavigateToTheme(themeId)`: set `filterThemeIds = [themeId]`
  - Pass `filterThemeIds` (not `filterThemeId`) to EisenKanView and CalendarView

- `frontend/src/views/EisenKanView.svelte`
  - Prop: `filterThemeIds: string[]` replacing `filterThemeId?: string`
  - Add props: `onFilterThemeToggle?: (themeId: string) => void`, `onFilterThemeClear?: () => void`
  - `filteredTasks`: `if (filterThemeIds.length > 0) result = result.filter(t => filterThemeIds.includes(t.themeId))`
  - Render `<ThemeFilterBar>` above the columns, passing themes, activeThemeIds, and callbacks

- `frontend/src/views/CalendarView.svelte`
  - Prop: `filterThemeIds: string[]` replacing `filterThemeId?: string`
  - Legend active class: `class:active={filterThemeIds.includes(theme.id)}`

### Key considerations
- `$effect` for persisting `filterThemeIds` to navigation context must use `untrack()` for writes to avoid infinite loops
- The smart default should only fire once on initial load, not re-trigger on theme changes
- Ensure `filterDate` mechanism still works alongside `filterThemeIds` (AND logic: both filters apply)
- Mock bindings in `wails-mock.ts` may need `GetYearFocus` mock if not already present
- Update existing tests that pass `filterThemeId` prop to use `filterThemeIds` instead

## Dependencies
- [ ] 001 — Go NavigationContext struct with FilterThemeIDs field

## Effort Estimate
- Size: L
- Hours: 4
- Parallel: false
